<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Prediksi Harga Emas</title>

    <!-- Bootstrap 5.2 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="bg-light">

    <nav class="navbar navbar-dark bg-dark px-3">
        <span class="navbar-brand">Gold Price Prediction</span>
    </nav>

    <div class="container py-4">

        <!-- Filter Buttons -->
        <div class="btn-group mb-3">
            <button class="btn btn-outline-primary filter-btn" data-filter="minute">Minute</button>
            <button class="btn btn-outline-primary filter-btn" data-filter="hour">Hour</button>
            <button class="btn btn-outline-primary filter-btn active" data-filter="day">Day</button>
            <button class="btn btn-outline-primary filter-btn" data-filter="week">Week</button>
            <button class="btn btn-outline-primary filter-btn" data-filter="month">Month</button>
            <button class="btn btn-outline-primary filter-btn" data-filter="year">Year</button>
        </div>

        <div class="mb-3">
            <h4>Harga Sekarang: <span id="currentPrice">...</span></h4>
            <h5>Prediksi Berikutnya: <span id="predictedPrice">...</span></h5>
            <h6>Perubahan: <span id="percentChange">...</span></h6>
        </div>

        <canvas id="goldChart" height="150"></canvas>
    </div>

    <script>
        const filterColors = {
            minute: "yellow",
            hour: "blue",
            day: "green",
            week: "purple",
            month: "red",
            year: "orange"
        };

        let chart;
        let currentFilter = "day";

        function loadChart(filterType = "day") {
            currentFilter = filterType;

            document.querySelectorAll(".filter-btn").forEach(btn => {
                btn.classList.remove("active");
                if (btn.dataset.filter === filterType) {
                    btn.classList.add("active");
                }
            });

            fetch(`/api/data/${filterType}`)
                .then(res => res.json())
                .then(data => {
                    const prices = data.prices;
                    const timestamps = data.timestamps;
                    const current = data.current_price;
                    const predicted = data.predicted_price;

                    document.getElementById("currentPrice").innerText = current.toFixed(2);
                    document.getElementById("predictedPrice").innerText = predicted.toFixed(2);
                    document.getElementById("percentChange").innerText = data.change_percent + "%";

                    // ========= CHART =========
                    if (chart) chart.destroy();

                    const ctx = document.getElementById("goldChart").getContext("2d");

                    chart = new Chart(ctx, {
                        type: "line",
                        data: {
                            labels: timestamps,
                            datasets: [
                                {
                                    label: "Harga Emas",
                                    data: prices,
                                    borderWidth: 2,
                                    borderColor: filterColors[filterType],
                                    tension: 0.2
                                },
                                {
                                    label: "Prediksi",
                                    data: [...Array(prices.length - 1).fill(null), predicted],
                                    borderColor: "white",
                                    borderWidth: 2,
                                    borderDash: [5, 5],
                                    tension: 0.2
                                }
                            ]
                        },
                        options: {
                            plugins: {
                                legend: { display: true }
                            }
                        }
                    });
                });
        }

        // Filter Buttons
        document.querySelectorAll(".filter-btn").forEach(btn => {
            btn.addEventListener("click", () => {
                const filter = btn.dataset.filter;
                loadChart(filter);
            });
        });

        // Auto refresh setiap 20 detik
        setInterval(() => loadChart("day"), 60000);

        // Default load
        loadChart("day");
    </script>

</body>

</html>